<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Basics - Memthol Mini Tutorial</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="basics.html" class="active"><strong aria-hidden="true">2.</strong> Basics</a></li><li class="chapter-item expanded "><a href="charts.html"><strong aria-hidden="true">3.</strong> Charts</a></li><li class="chapter-item expanded "><a href="global_settings.html"><strong aria-hidden="true">4.</strong> Global Settings</a></li><li class="chapter-item expanded "><a href="callstack_filters.html"><strong aria-hidden="true">5.</strong> Callstack Filters</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Memthol Mini Tutorial</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#basics" id="basics">Basics</a></h1>
<p>Our running example in this section will be <code>rsc/dumps/mini_ae.ctf</code>:</p>
<pre><code class="language-bash">❯ memthol --filter_gen none rsc/dumps/ctf/mini_ae.ctf
|===| Starting
| url: http://localhost:7878
| target: `rsc/dumps/ctf/mini_ae.ctf`
|===|

</code></pre>
<p>Notice the odd <code>--filter_gen none</code> passed to memthol. Ignore it for now, it will be discussed <a href="#filter-generation" title="Filter Generation Section">later
in this section</a>.</p>
<p>Once memthol is running, <code>http://localhost:7878/</code> (here) will lead you to memthol's BUI, which
should look something like this:</p>
<p><img src="basics_pics/default.png" alt="" /></p>
<p><br />
</p>
<p>Click on the orange <strong>everything</strong> tab at the bottom left of the screen.</p>
<p><img src="basics_pics/three_parts.png" alt="" /></p>
<p><br />
</p>
<p>Memthol's interface is split in three parts:</p>
<ul>
<li>
<p>the central, main part displays charts. There is only one here, showing the evolution of the
program's total memory size over time based on the memory dump.</p>
</li>
<li>
<p>the header gives statistics about the memory dump and handles general settings. There is currently
only one, the <em>time window</em>.</p>
</li>
<li>
<p>the footer controls your <em>filters</em> (there is only one here), which we are going to discuss right
now.</p>
</li>
</ul>
<h2><a class="header" href="#filters" id="filters">Filters</a></h2>
<p><em>Filters</em> allow to split allocations and display them separately. A filter is essentially a set of
allocations. Memthol has two built-in filters. The first one is the <strong>everything</strong> filter. You
cannot really do anything with it except for changing its name and color using the filter settings
in the footer.</p>
<p><img src="basics_pics/everything_name_color.png" alt="" /></p>
<p><br />
</p>
<p>Notice that when a filter is modified, two buttons appear in the top-left part of the footer. The
first reverts the changes while the second one saves them. Let's save these changes.</p>
<p><img src="basics_pics/everything_saved.png" alt="" /></p>
<p><br />
</p>
<p>The <strong>everything</strong> filter always contains all allocations in the memory dump. It cannot be changed
besides the cosmetic changes we just did. These changes are reverted in the rest of the section.</p>
<h2><a class="header" href="#custom-filters" id="custom-filters">Custom Filters</a></h2>
<p>Let's create a new filter using the <code>+</code> add button in the top-right part of the footer.</p>
<p><img src="basics_pics/new_filter.png" alt="" /></p>
<p><br />
</p>
<p>Notice that, unlike <strong>everything</strong>, the settings for our new filter have a <strong>Catch allocation if
...</strong> (empty) section with a <code>+</code> add button. Let's click on that.</p>
<p><img src="basics_pics/new_sub_filter.png" alt="" /></p>
<p><br />
</p>
<p>This adds a criterion to our filter. Let's modify it so that the our filter catches everything of size greater than zero machine words, rename the filter, and save these changes.</p>
<p><img src="basics_pics/new_filter_1.png" alt="" /></p>
<p>The tab for our filter now shows <strong>(3)</strong> next to its name, indicating that this filter catches 3
allocations, which is all the allocations of the (tiny) dump.</p>
<p><br />
</p>
<p>Now, create a new filter and modify it so that it catches allocations made in file <code>weak.ml</code>. This requires</p>
<ul>
<li>
<p>creating a filter,</p>
</li>
<li>
<p>adding a criterion to that filter,</p>
</li>
<li>
<p>switching it from <code>size</code> to <code>callstack</code></p>
</li>
<li>
<p>removing the trailing <code>**</code> (anything) by erasing it,</p>
</li>
<li>
<p>write <code>weak.ml</code> as the last file that should appear in the callstack.</p>
</li>
</ul>
<p>After saving it, you should get the following.</p>
<p><img src="basics_pics/new_filter_2.png" alt="" /></p>
<p><br />
</p>
<p>Sadly, this filter does not match anything, although some allocations fit this filter. This is
because a <strong>custom filter</strong> <code>F</code> &quot;catches&quot; an allocation if</p>
<ul>
<li>all of the criteria of <code>F</code> are true for this allocation, and</li>
<li>the allocation is not caught by any <strong>custom</strong> filter at the left of <code>F</code> (note that the
<strong>everything</strong> filter is not a **custom filter).</li>
</ul>
<p>In other words, all allocations go through the list of custom filters from left to right, and are
caught by the first filter such that all of its criteria are true for this allocation. As such, it
is similar to switch/case and pattern matching.</p>
<p><br />
</p>
<p>Let's move our new filter to the left by clicking the left arrow next to it, and save the change.</p>
<p><img src="basics_pics/new_filter_3.png" alt="" /></p>
<p><br />
</p>
<p>Nice.</p>
<p><br />
</p>
<p>You can remove a filter by selecting it and clicking the <code>-</code> remove button in the top-right part of
the footer, next to the <code>+</code> add filter button. This only works for <strong>custom</strong> filters, you cannot
remove built-in filters.</p>
<p>Now, remove the first filter we created (size ≥ 0), which should give you this:</p>
<p><img src="basics_pics/new_filter_4.png" alt="" /></p>
<p><br />
</p>
<p>Out of nowhere, we get the second and last built-in filter: <strong>catch-all</strong>. When some allocations are
not caught by any of your filters, they will end up in this filter. <strong>Catch-all</strong> is not visible
when it does not catch any allocation, which is why it was (mostly) not visible until now. The
filter we wrote previously where catching all the allocations.</p>
<blockquote>
<p>In the switch/case analogy, <strong>catch-all</strong> is the <code>else</code>/<code>default</code> branch. In pattern matching, it
would be a trailing wildcard <code>_</code>.</p>
</blockquote>
<p>So, <code>weak.ml</code> only catches one of the three allocations: <strong>catch-all</strong> appears and indicates it
matches the remaining two.</p>
<blockquote>
<p>It is also possible to write filter criteria over allocations' callstacks. This is discussed in
the <a href="./callstack_filters.html">Callstack Filters Section</a>.</p>
</blockquote>
<h2><a class="header" href="#filter-generation" id="filter-generation">Filter Generation</a></h2>
<p>When we launched this section's running example, we passed <code>--filter_gen none</code> to memthol. This is
because, by default, memthol will run <em>automatic filter generation</em> which scans allocations and
generates filters. The default (and currently only) one creates one filter per allocation-site file.</p>
<blockquote>
<p>For more details, in particular filter generation customization, run <code>memthol --filter_gen help</code>.</p>
</blockquote>
<p>If we relaunch the example without <code>--filter_gen none</code></p>
<pre><code class="language-bash">❯ memthol rsc/dumps/ctf/mini_ae.ctf
|===| Starting
| url: http://localhost:7878
| target: `rsc/dumps/ctf/mini_ae.ctf`
|===|

</code></pre>
<p>we get something like this (actual colors may vary):</p>
<p><img src="basics_pics/filter_gen.png" alt="" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="charts.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="charts.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
